<header> <%= render "shared/navbar" %> </header>

<div class="home-body" >

  <h1> Welcome <%= current_user.name.capitalize %></h1>

  <div class="home-split">

    <div class="card-holder">
      <h3>Your favourite restaurants</h3>
      <div class="card-scroll">
        <ul style="padding: 0px"> <% @restaurants.each do |restaurant| %>
          <li class= "card">
            <div class="card-product">
              <div class="img-block">
                <%= image_tag(restaurant.photo_url.presence || "burger.jpeg", alt: "restau_poster") %>
                <%= link_to " ", restaurant_path(restaurant), data:{turbo_method: :delete, turbo_confirm: "Are you sure?"},  class:"fa-regular fa-circle-xmark delete-icon" %>
                  </div>
                  <div class="card-product-infos">
                    <div class="card-content-text">
                      <h2><%= restaurant.name %></h2>
                      <h4><%= restaurant.category %></h4>
                      <p> <%= restaurant.address %></p>
                      </div>
                    <div class="card-content-numbers">
                  <p><i class="fa-regular fa-star"></i> <%= restaurant.rating %></p>
                  <p><%= restaurant.budget %></p>
                </div>
              </div>
            </div>
          </li>
          <% end %>
        </ul>
      </div>
      <%= button_to "Add a new restaurant",
        chats_path,
        method: :post,
        class:"btn btn-ghost my-2",
        style: "width: 400px" %>
    </div>

    <div class="favourite-generator">

      <h3> Your Profile </h3>
      <p class= "typewriter"><%= @my_profile %></p>
      <%= button_to "Who am I ?",
        profils_path(current_user),
        method: :post,
        class:"btn btn-ghost my-2",
        style: "width: 400px" %>

      <div class="favourite-generator" data-controller ="favoritemap"  data-favoritemap-markers-value="<%= @restaurants.map { |restaurant|
        { lng: restaurant.longitude, lat: restaurant.latitude, name: restaurant.name }
        }.to_json %>">

        <div>
          <div id="map" data-favoritemap-target="map" style="height: 400px"; class="d-none"></div>
          <script src="https://api.mapbox.com/mapbox-gl-js/v3.16.0/mapbox-gl.js"></script>
        </div>

        <% if @restaurants.any? %>
          <button  type="button" style= "width: 300px"
            class="btn btn-ghost my-2"
            data-action="click->favoritemap#toggleMap"
            data-favoritemap-target="button">Display the map</button>
        <% end %>

      </div>
    </div>
  </div>
</div>

<footer> <%= render "shared/footer" %> </footer>
